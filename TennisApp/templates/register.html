{% include 'layout.html' %}
<div class="container">
    <h2>Register</h2>
    <form id="registerForm">
        <input type="email" id="email" name="email" placeholder="Email" required>
        <input type="text" id="username" name="username" placeholder="Username" required>
        <p>…it’s best to use your block and apartment number as username. E.g., d203</p>
        <input type="text" id="firstName" name="first_name" placeholder="First Name" required>
        <input type="text" id="lastName" name="last_name" placeholder="Last Name" required>
        <input type="text" id="role" name="role" value="Resident" readonly required>
        <input type="text" id="apartmentNumber" name="apartment_number" placeholder="Apartment Number" required>
        <input type="tel" id="phoneNumber" name="phone_number" placeholder="Phone Number" pattern="^\+?[0-9]+$" required>
        <div class="password-field">
            <input type="password" id="password1" name="password" placeholder="Password" required>
            <i class="far fa-eye-slash" id="togglePassword1"></i>
        </div>
        <div class="password-field">
            <input type="password" id="verifyPassword" placeholder="Verify Password" required>
            <i class="far fa-eye-slash" id="togglePassword2"></i>
        </div>
        <div id="error" class="error-message"></div>
        <button type="submit">Sign Up</button>
    </form>
    <p></p>
    <div class="links">
        <a href="/auth/login-page">Already have an account?</a>
    </div>
</div>
<script>
    const password1 = document.getElementById('password1');
    const verifyPassword = document.getElementById('verifyPassword');
    const errorDiv = document.getElementById('error');

    password1.addEventListener('input', checkPasswordMatch);
    verifyPassword.addEventListener('input', checkPasswordMatch);

    function checkPasswordMatch() {
        if (password1.value !== verifyPassword.value) {
            errorDiv.textContent = 'Passwords do not match';
            errorDiv.style.color = 'red';
        } else {
            errorDiv.textContent = '';
        }
    }
    
    // password toggle - fa-eye
    document.addEventListener('DOMContentLoaded', function() {
        const togglePassword1 = document.querySelector('#togglePassword1');
        const togglePassword2 = document.querySelector('#togglePassword2');
        const password1 = document.querySelector('#password1');
        const verifyPassword = document.querySelector('#verifyPassword');
        
        function togglePasswordVisibility(field, icon) {
            if (!field || !icon) return;
            const type = field.getAttribute('type') === 'password' ? 'text' : 'password';
            field.setAttribute('type', type);
            icon.classList.toggle('fa-eye-slash');
            icon.classList.toggle('fa-eye');
        }

        if (togglePassword1) {
            togglePassword1.addEventListener('click', function() {
                togglePasswordVisibility(password1, this);
            });
        }
        if (togglePassword2) {
            togglePassword2.addEventListener('click', function() {
                togglePasswordVisibility(verifyPassword, this);
            });
        }
    });

    // Submit the form
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('registerForm');
        const errorDiv = document.getElementById('error');
    
        form.addEventListener('submit', function(e) {
            e.preventDefault();
    
            if (password1.value !== verifyPassword.value) {
                errorDiv.textContent = 'Passwords do not match';
                errorDiv.style.color = 'red';
                return;
            }
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
    
            fetch('/auth/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.message) {
                    errorDiv.textContent = result.message;
                    errorDiv.style.color = 'green';
                    form.reset();
                } else if (result.error) {
                    errorDiv.textContent = result.error;
                    errorDiv.style.color = 'red';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                errorDiv.textContent = 'An error occurred. Please try again.';
                errorDiv.style.color = 'red';
            });
        });
    });    
</script>
